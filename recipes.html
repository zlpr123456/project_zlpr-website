<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çº¸ä¸Šæ»‘é›ªçš„å®¶åº­é£Ÿè°±</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="recipe-styles.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>ğŸš€ çº¸ä¸Šæ»‘é›ªçš„æ‚ç‰©é—´</h1>
            <p class="subtitle">é«˜è´¨é‡å·¥å…·å’Œè½¯ä»¶ä¸‹è½½å¹³å°</p>
            <nav class="main-nav">
                <a href="index.html" class="nav-link">ğŸ  é¦–é¡µ</a>
                <a href="recipes.html" class="nav-link active">ğŸ³ å®¶åº­é£Ÿè°±</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <section class="recipe-sub-nav">
            <a href="recipes.html" class="sub-nav-link active">ğŸ“– é£Ÿè°±åˆ—è¡¨</a>
            <a href="create-recipe.html" class="sub-nav-link">â• åˆ›å»ºé£Ÿè°±</a>
            <a href="favorites.html" class="sub-nav-link">â­ æˆ‘çš„æ”¶è—</a>
        </section>

        <section class="search-section">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="æœç´¢é£Ÿè°±..." class="search-input">
                <button onclick="searchRecipes()" class="btn btn-primary">ğŸ” æœç´¢</button>
            </div>
            <div class="filter-buttons">
                <button onclick="filterByCategory('all')" class="btn btn-secondary filter-btn active">å…¨éƒ¨</button>
                <button onclick="filterByCategory('å®¶å¸¸èœ')" class="btn btn-secondary filter-btn">å®¶å¸¸èœ</button>
                <button onclick="filterByCategory('ç”œç‚¹')" class="btn btn-secondary filter-btn">ç”œç‚¹</button>
                <button onclick="filterByCategory('æ±¤å“')" class="btn btn-secondary filter-btn">æ±¤å“</button>
                <button onclick="filterByCategory('ä¸»é£Ÿ')" class="btn btn-secondary filter-btn">ä¸»é£Ÿ</button>
            </div>
        </section>

        <section class="recipes-grid" id="recipesGrid">
            <div class="loading">åŠ è½½ä¸­...</div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2026 çº¸ä¸Šæ»‘é›ªçš„å®¶åº­é£Ÿè°±. All rights reserved.</p>
        </div>
    </footer>

    <script src="recipe-api.js"></script>
    <script>
        let currentCategory = 'all';
        let currentSearch = '';

        async function loadRecipes() {
            const grid = document.getElementById('recipesGrid');
            grid.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';

            try {
                let recipes = [];
                if (currentSearch) {
                    recipes = await searchRecipesAPI(currentSearch);
                } else if (currentCategory === 'all') {
                    recipes = await getAllRecipes();
                } else {
                    recipes = await getRecipesByCategory(currentCategory);
                }

                if (recipes.length === 0) {
                    grid.innerHTML = '<div class="empty-state">æš‚æ— é£Ÿè°±</div>';
                    return;
                }

                grid.innerHTML = recipes.map(recipe => `
                    <div class="recipe-card" onclick="viewRecipe(${recipe.id})">
                        <div class="recipe-image">
                            ${recipe.cover_image ? 
                                `<img src="${recipe.cover_image}" alt="${recipe.title}" onerror="this.src='https://via.placeholder.com/400x300?text=æš‚æ— å›¾ç‰‡'">` :
                                `<div class="no-image">æš‚æ— å›¾ç‰‡</div>`
                            }
                            <div class="recipe-badge">${recipe.difficulty}</div>
                        </div>
                        <div class="recipe-info">
                            <h3 class="recipe-title">${recipe.title}</h3>
                            <p class="recipe-description">${recipe.description || 'æš‚æ— æè¿°'}</p>
                            <div class="recipe-meta">
                                <span class="meta-item">â±ï¸ ${recipe.cooking_time || 'æœªçŸ¥'}åˆ†é’Ÿ</span>
                                <span class="meta-item">ğŸ‘¥ ${recipe.servings || 'æœªçŸ¥'}äººä»½</span>
                                <span class="meta-item">ğŸ“… ${formatDate(recipe.created_at)}</span>
                            </div>
                            <div class="recipe-tags">
                                ${recipe.tags ? recipe.tags.split(',').map(tag => 
                                    `<span class="tag">${tag.trim()}</span>`
                                ).join('') : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('åŠ è½½é£Ÿè°±å¤±è´¥:', error);
                grid.innerHTML = '<div class="error">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>';
            }
        }

        function viewRecipe(id) {
            window.location.href = `recipe-detail.html?id=${id}`;
        }

        function searchRecipes() {
            currentSearch = document.getElementById('searchInput').value;
            loadRecipes();
        }

        function filterByCategory(category) {
            currentCategory = category;
            currentSearch = '';
            document.getElementById('searchInput').value = '';
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadRecipes();
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN');
        }

        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchRecipes();
            }
        });

        loadRecipes();
    </script>
</body>
</html>